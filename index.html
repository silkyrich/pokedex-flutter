<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pokémon Database</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--blue:#3b5ba7;--blue-dark:#2a4480;--bg:#f0f0f0;--card-bg:#fff;--text:#333;--text-light:#666;--text-muted:#999;--border:#ddd}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
a{color:var(--blue);text-decoration:none}
a:hover{text-decoration:underline}

/* Header */
.header{background:var(--blue);color:#fff;padding:0 16px;position:sticky;top:0;z-index:100;box-shadow:0 2px 8px rgba(0,0,0,.15)}
.header-inner{max-width:1100px;margin:0 auto;display:flex;align-items:center;height:52px;gap:24px}
.logo{font-size:20px;font-weight:700;color:#fff;cursor:pointer;white-space:nowrap}
.logo:hover{text-decoration:none}
.logo span{color:#ffcb05}
nav{display:flex;gap:4px}
nav a{color:rgba(255,255,255,.85);padding:6px 12px;border-radius:4px;font-size:14px;font-weight:500;transition:background .15s}
nav a:hover{background:rgba(255,255,255,.15);text-decoration:none;color:#fff}
nav a.active{background:rgba(255,255,255,.2);color:#fff}
.search-box{margin-left:auto;position:relative}
.search-box input{width:200px;padding:6px 12px 6px 32px;border:none;border-radius:4px;font-size:14px;background:rgba(255,255,255,.2);color:#fff;outline:none;transition:width .2s}
.search-box input::placeholder{color:rgba(255,255,255,.6)}
.search-box input:focus{background:rgba(255,255,255,.95);color:#333;width:280px}
.search-box input:focus::placeholder{color:#999}
.search-box svg{position:absolute;left:8px;top:50%;transform:translateY(-50%);width:16px;height:16px;fill:rgba(255,255,255,.6);pointer-events:none}
.search-box input:focus~svg{fill:#999}
.search-results{position:absolute;top:100%;left:0;right:0;background:#fff;border-radius:0 0 8px 8px;box-shadow:0 8px 24px rgba(0,0,0,.15);max-height:400px;overflow-y:auto;display:none;z-index:200}
.search-results.visible{display:block}
.search-result{display:flex;align-items:center;padding:8px 12px;cursor:pointer;gap:10px;border-bottom:1px solid #f0f0f0}
.search-result:hover{background:#f5f8ff}
.search-result img{width:40px;height:40px}
.search-result .sr-name{font-weight:600;color:var(--blue);font-size:14px}
.search-result .sr-id{color:var(--text-muted);font-size:12px}

/* Hamburger */
.hamburger{display:none;background:none;border:none;color:#fff;font-size:24px;cursor:pointer;padding:4px 8px}
@media(max-width:700px){
  nav{display:none;position:absolute;top:52px;left:0;right:0;background:var(--blue-dark);flex-direction:column;padding:8px}
  nav.open{display:flex}
  .hamburger{display:block}
  .search-box input{width:140px}
  .search-box input:focus{width:180px}
}

/* Main content */
.container{max-width:1100px;margin:0 auto;padding:20px 16px}

/* Page: Pokédex */
.page-title{font-size:28px;font-weight:700;margin-bottom:4px}
.page-subtitle{color:var(--text-light);font-size:15px;margin-bottom:20px}
.gen-filters{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:20px}
.gen-btn{padding:5px 12px;border:1px solid var(--border);border-radius:4px;background:#fff;cursor:pointer;font-size:13px;font-weight:500;color:var(--text-light);transition:all .15s}
.gen-btn:hover{border-color:var(--blue);color:var(--blue)}
.gen-btn.active{background:var(--blue);color:#fff;border-color:var(--blue)}
.pokemon-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:12px}
.poke-card{background:var(--card-bg);border:1px solid var(--border);border-radius:8px;padding:12px 8px;text-align:center;cursor:pointer;transition:all .15s}
.poke-card:hover{border-color:var(--blue);box-shadow:0 4px 12px rgba(59,91,167,.12);transform:translateY(-2px)}
.poke-card .poke-id{color:var(--text-muted);font-size:11px;font-weight:700}
.poke-card img{width:80px;height:80px;image-rendering:pixelated}
.poke-card .poke-name{font-weight:700;font-size:13px;color:var(--blue);margin-top:2px}
.poke-card .types{display:flex;justify-content:center;gap:3px;margin-top:4px}
.load-more{display:block;margin:24px auto;padding:10px 32px;background:var(--blue);color:#fff;border:none;border-radius:6px;font-size:15px;font-weight:600;cursor:pointer;transition:background .15s}
.load-more:hover{background:var(--blue-dark)}

/* Type badges */
.type-badge{display:inline-block;padding:2px 8px;border-radius:3px;font-size:11px;font-weight:700;color:#fff;text-transform:capitalize;line-height:1.4}
.type-badge.large{padding:3px 12px;font-size:13px;border-radius:4px}

/* Page: Detail */
.detail-nav{display:flex;justify-content:space-between;margin-bottom:12px}
.detail-nav a{font-size:14px}
.detail-header{margin-bottom:16px}
.detail-header h1{font-size:32px;font-weight:700}
.detail-header .did{color:var(--text-muted);font-size:16px;font-weight:700}
.detail-layout{display:grid;grid-template-columns:2fr 3fr;gap:24px;margin-bottom:24px}
@media(max-width:700px){.detail-layout{grid-template-columns:1fr}}
.detail-img{padding:24px;border-radius:12px;text-align:center}
.detail-img img{max-width:250px;width:100%}
.detail-info{background:#fff;border:1px solid var(--border);border-radius:12px;padding:20px}
.detail-info .flavor{font-size:15px;line-height:1.6;color:#444;margin-bottom:16px}
.info-table{width:100%;border-collapse:collapse}
.info-table th{text-align:left;padding:4px 16px 4px 0;font-size:14px;color:#555;font-weight:600;white-space:nowrap;vertical-align:top}
.info-table td{padding:4px 0;font-size:14px}

/* Section cards */
.section-card{background:#fff;border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:24px}
.section-card h2{font-size:22px;font-weight:700;color:var(--text);margin-bottom:16px}

/* Stats */
.stat-row{display:flex;align-items:center;margin-bottom:6px}
.stat-label{width:45px;font-size:13px;font-weight:600;color:#555;text-transform:uppercase}
.stat-abbr{width:45px;font-size:13px;font-weight:600;color:#555}
.stat-val{width:36px;text-align:right;font-size:14px;font-weight:600;margin-right:10px}
.stat-bar-bg{flex:1;height:14px;background:#f0f0f0;border-radius:7px;overflow:hidden}
.stat-bar-fill{height:100%;border-radius:7px;transition:width .4s ease}

/* Evolution */
.evo-chain{display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:8px}
.evo-pokemon{text-align:center;padding:12px;border-radius:8px;cursor:pointer;transition:background .15s}
.evo-pokemon:hover{background:#f0f4ff}
.evo-pokemon.current{background:#e8edf5;border:1px solid var(--blue)}
.evo-pokemon img{width:68px;height:68px}
.evo-pokemon .evo-name{font-weight:700;font-size:13px;color:var(--blue)}
.evo-arrow{color:var(--text-muted);font-size:20px;display:flex;flex-direction:column;align-items:center}
.evo-arrow small{font-size:11px}

/* Type defenses */
.defense-group{margin-bottom:12px}
.defense-group h4{font-size:13px;font-weight:700;margin-bottom:6px}
.defense-badges{display:flex;flex-wrap:wrap;gap:6px}
.defense-badge{display:flex;border-radius:4px;overflow:hidden;font-size:12px;font-weight:700}
.defense-badge .db-type{padding:3px 8px;color:#fff}
.defense-badge .db-mult{padding:3px 6px}
.db-mult.weak{background:#ffdddd}
.db-mult.resist{background:#ddffdd}
.db-mult.immune{background:#e0e0e0}

/* Moves table */
.moves-tabs{display:flex;gap:0;border-bottom:2px solid #eee;margin-bottom:12px}
.moves-tab{padding:8px 16px;font-size:14px;font-weight:600;color:var(--text-muted);cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-2px;transition:all .15s}
.moves-tab:hover{color:var(--text)}
.moves-tab.active{color:var(--blue);border-bottom-color:var(--blue)}
.moves-table{width:100%;border-collapse:collapse;font-size:13px}
.moves-table th{text-align:left;padding:6px 8px;border-bottom:2px solid #eee;font-size:12px;color:#555;cursor:pointer;user-select:none;white-space:nowrap}
.moves-table th:hover{color:var(--blue)}
.moves-table td{padding:6px 8px;border-bottom:1px solid #f5f5f5}
.moves-table tr:hover{background:#f9fbff}
.moves-table .move-name{font-weight:600;color:var(--blue)}

/* Page: Type Chart */
.type-chart-wrap{overflow-x:auto}
.type-chart{border-collapse:collapse;font-size:11px;text-align:center}
.type-chart th,.type-chart td{width:32px;height:28px;min-width:32px;border:1px solid #e0e0e0}
.type-chart th{font-weight:700;padding:2px 4px}
.type-chart .rotate-header{writing-mode:vertical-rl;transform:rotate(180deg);padding:4px 2px;font-size:10px}
.tc-2{background:#5fbd58;color:#fff;font-weight:700}
.tc-half{background:#e74c3c;color:#fff;font-weight:700;font-size:10px}
.tc-0{background:#2c2c2c;color:#fff;font-weight:700}
.tc-1{background:#f8f8f8}
.chart-legend{display:flex;gap:16px;margin-top:12px;font-size:13px}
.chart-legend span{display:flex;align-items:center;gap:4px}
.legend-box{width:20px;height:16px;border-radius:3px;display:inline-block}

/* Page: Moves list */
.moves-filter{display:flex;gap:12px;margin-bottom:16px;flex-wrap:wrap;align-items:center}
.moves-filter select,.moves-filter input{padding:6px 12px;border:1px solid var(--border);border-radius:4px;font-size:14px;background:#fff}
.moves-filter input{width:200px}

/* Loading & error */
.loading{text-align:center;padding:60px 20px;color:var(--text-muted)}
.spinner{display:inline-block;width:32px;height:32px;border:3px solid #ddd;border-top-color:var(--blue);border-radius:50%;animation:spin .7s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.error-msg{text-align:center;padding:40px;color:#c00;font-size:15px}

/* Footer */
.footer{text-align:center;padding:24px 16px;color:var(--text-muted);font-size:13px;margin-top:40px;border-top:1px solid var(--border)}
</style>
</head>
<body>

<div class="header">
  <div class="header-inner">
    <a class="logo" onclick="navigate('pokedex')">Pokémon<span>DB</span></a>
    <button class="hamburger" onclick="this.nextElementSibling.classList.toggle('open')">☰</button>
    <nav id="main-nav">
      <a onclick="navigate('pokedex')" class="active" data-page="pokedex">Pokédex</a>
      <a onclick="navigate('types')" data-page="types">Type Chart</a>
      <a onclick="navigate('moves')" data-page="moves">Moves</a>
    </nav>
    <div class="search-box">
      <input type="text" id="search-input" placeholder="Search Pokémon..." oninput="handleSearch(this.value)" onfocus="showSearchResults()" onblur="setTimeout(()=>hideSearchResults(),200)">
      <svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.47 6.47 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
      <div class="search-results" id="search-results"></div>
    </div>
  </div>
</div>

<div class="container" id="app">
  <div class="loading"><div class="spinner"></div><p style="margin-top:12px">Loading Pokédex...</p></div>
</div>

<div class="footer">
  Pokémon Database — Powered by <a href="https://pokeapi.co/" target="_blank">PokéAPI</a> — Built with vanilla HTML/CSS/JS
</div>

<script>
// ═══════════════════════════════════════
// TYPE DATA
// ═══════════════════════════════════════
const TYPES = ['normal','fire','water','electric','grass','ice','fighting','poison','ground','flying','psychic','bug','rock','ghost','dragon','dark','steel','fairy'];

const TYPE_COLORS = {
  normal:'#A8A878',fire:'#F08030',water:'#6890F0',electric:'#F8D030',grass:'#78C850',
  ice:'#98D8D8',fighting:'#C03028',poison:'#A040A0',ground:'#E0C068',flying:'#A890F0',
  psychic:'#F85888',bug:'#A8B820',rock:'#B8A038',ghost:'#705898',dragon:'#7038F8',
  dark:'#705848',steel:'#B8B8D0',fairy:'#EE99AC'
};

const TYPE_TEXT_COLORS = {
  normal:'#fff',fire:'#fff',water:'#fff',electric:'#333',grass:'#fff',
  ice:'#333',fighting:'#fff',poison:'#fff',ground:'#333',flying:'#333',
  psychic:'#fff',bug:'#fff',rock:'#fff',ghost:'#fff',dragon:'#fff',
  dark:'#fff',steel:'#333',fairy:'#333'
};

// Type chart: effectiveness[attacker][defender]
const EFF = {};
TYPES.forEach(t => EFF[t] = {});
TYPES.forEach(a => TYPES.forEach(d => EFF[a][d] = 1));
// Super effective (2x)
const se = {
  normal:[],fire:['grass','ice','bug','steel'],water:['fire','ground','rock'],
  electric:['water','flying'],grass:['water','ground','rock'],ice:['grass','ground','flying','dragon'],
  fighting:['normal','ice','rock','dark','steel'],poison:['grass','fairy'],ground:['fire','electric','poison','rock','steel'],
  flying:['grass','fighting','bug'],psychic:['fighting','poison'],bug:['grass','psychic','dark'],
  rock:['fire','ice','flying','bug'],ghost:['psychic','ghost'],dragon:['dragon'],
  dark:['psychic','ghost'],steel:['ice','rock','fairy'],fairy:['fighting','dragon','dark']
};
// Not very effective (0.5x)
const nve = {
  normal:['rock','steel'],fire:['fire','water','rock','dragon'],water:['water','grass','dragon'],
  electric:['electric','grass','dragon'],grass:['fire','grass','poison','flying','bug','dragon','steel'],
  ice:['fire','water','ice','steel'],fighting:['poison','flying','psychic','bug','fairy'],
  poison:['poison','ground','rock','ghost'],ground:['grass','bug'],flying:['electric','rock','steel'],
  psychic:['psychic','steel'],bug:['fire','fighting','poison','flying','ghost','steel','fairy'],
  rock:['fighting','ground','steel'],ghost:['dark'],dragon:['steel'],dark:['fighting','dark','fairy'],
  steel:['fire','water','electric','steel'],fairy:['fire','poison','steel']
};
// No effect (0x)
const ne = {
  normal:['ghost'],fire:[],water:[],electric:['ground'],grass:[],ice:[],
  fighting:['ghost'],poison:['steel'],ground:['flying'],flying:[],
  psychic:['dark'],bug:[],rock:[],ghost:['normal'],dragon:['fairy'],
  dark:[],steel:[],fairy:[]
};
for (const [a, defs] of Object.entries(se)) defs.forEach(d => EFF[a][d] = 2);
for (const [a, defs] of Object.entries(nve)) defs.forEach(d => EFF[a][d] = 0.5);
for (const [a, defs] of Object.entries(ne)) defs.forEach(d => EFF[a][d] = 0);

// Gen ranges
const GENS = [
  {label:'All',start:1,end:1025},
  {label:'Gen I',start:1,end:151},{label:'Gen II',start:152,end:251},
  {label:'Gen III',start:252,end:386},{label:'Gen IV',start:387,end:493},
  {label:'Gen V',start:494,end:649},{label:'Gen VI',start:650,end:721},
  {label:'Gen VII',start:722,end:809},{label:'Gen VIII',start:810,end:905},
  {label:'Gen IX',start:906,end:1025}
];

// ═══════════════════════════════════════
// CACHE & STATE
// ═══════════════════════════════════════
const cache = {};
let allPokemonList = null; // [{name,url,id}]
let currentPage = 'pokedex';
let currentPokemonId = null;

async function apiFetch(url) {
  if (cache[url]) return cache[url];
  const res = await fetch(url);
  if (!res.ok) throw new Error(`API error ${res.status}`);
  const data = await res.json();
  cache[url] = data;
  return data;
}

// ═══════════════════════════════════════
// HELPERS
// ═══════════════════════════════════════
function capitalize(s) { return s.split('-').map(w => w[0].toUpperCase() + w.slice(1)).join(' '); }
function pokemonSprite(id) { return `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${id}.png`; }
function pokemonArtwork(id) { return `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${id}.png`; }
function padId(id) { return '#' + String(id).padStart(4, '0'); }

function typeBadge(type, large) {
  return `<span class="type-badge${large ? ' large' : ''}" style="background:${TYPE_COLORS[type]};color:${TYPE_TEXT_COLORS[type]}">${type}</span>`;
}

function statColor(val) {
  if (val < 30) return '#f34444';
  if (val < 60) return '#ff7f0f';
  if (val < 90) return '#ffdd57';
  if (val < 120) return '#a0e515';
  if (val < 150) return '#23cd5e';
  return '#00c2b8';
}

const STAT_ABBR = {'hp':'HP','attack':'Atk','defense':'Def','special-attack':'SpA','special-defense':'SpD','speed':'Spe'};

// ═══════════════════════════════════════
// NAVIGATION
// ═══════════════════════════════════════
function navigate(page, data) {
  currentPage = page;
  document.querySelectorAll('nav a').forEach(a => a.classList.toggle('active', a.dataset.page === page));
  document.querySelector('nav')?.classList.remove('open');
  window.scrollTo(0, 0);

  if (page === 'pokedex') renderPokedex();
  else if (page === 'detail') renderDetail(data);
  else if (page === 'types') renderTypeChart();
  else if (page === 'moves') renderMovesPage();
}

// ═══════════════════════════════════════
// SEARCH
// ═══════════════════════════════════════
async function ensurePokemonList() {
  if (allPokemonList) return allPokemonList;
  const data = await apiFetch('https://pokeapi.co/api/v2/pokemon?limit=1025');
  allPokemonList = data.results.map((p, i) => ({name: p.name, url: p.url, id: i + 1}));
  return allPokemonList;
}

let searchTimeout = null;
async function handleSearch(q) {
  clearTimeout(searchTimeout);
  if (!q.trim()) { hideSearchResults(); return; }
  searchTimeout = setTimeout(async () => {
    const list = await ensurePokemonList();
    const ql = q.toLowerCase();
    const matches = list.filter(p => p.name.includes(ql) || String(p.id) === ql || padId(p.id).includes(ql)).slice(0, 12);
    const el = document.getElementById('search-results');
    el.innerHTML = matches.map(p => `
      <div class="search-result" onmousedown="navigate('detail',${p.id})">
        <img src="${pokemonSprite(p.id)}" alt="${p.name}" loading="lazy">
        <div><div class="sr-name">${capitalize(p.name)}</div><div class="sr-id">${padId(p.id)}</div></div>
      </div>
    `).join('') || '<div style="padding:16px;color:#999;text-align:center">No results</div>';
    el.classList.add('visible');
  }, 200);
}
function showSearchResults() { if (document.getElementById('search-results').innerHTML) document.getElementById('search-results').classList.add('visible'); }
function hideSearchResults() { document.getElementById('search-results').classList.remove('visible'); }

// ═══════════════════════════════════════
// PAGE: POKÉDEX
// ═══════════════════════════════════════
let pokedexGen = 0;
let pokedexLoaded = 0;
const BATCH = 50;

async function renderPokedex() {
  const app = document.getElementById('app');
  app.innerHTML = `
    <h1 class="page-title">Pokédex</h1>
    <p class="page-subtitle">Complete list of Pokémon from all generations.</p>
    <div class="gen-filters" id="gen-filters"></div>
    <div class="pokemon-grid" id="pokemon-grid"></div>
    <div id="load-more-wrap"></div>
  `;
  renderGenFilters();
  pokedexLoaded = 0;
  await loadPokedexBatch();
}

function renderGenFilters() {
  const el = document.getElementById('gen-filters');
  el.innerHTML = GENS.map((g, i) => `<button class="gen-btn${i === pokedexGen ? ' active' : ''}" onclick="switchGen(${i})">${g.label}</button>`).join('');
}

async function switchGen(idx) {
  pokedexGen = idx;
  pokedexLoaded = 0;
  document.getElementById('pokemon-grid').innerHTML = '';
  renderGenFilters();
  await loadPokedexBatch();
}

async function loadPokedexBatch() {
  const gen = GENS[pokedexGen];
  const grid = document.getElementById('pokemon-grid');
  const wrap = document.getElementById('load-more-wrap');

  const startId = gen.start + pokedexLoaded;
  const endId = Math.min(gen.start + pokedexLoaded + BATCH - 1, gen.end);

  if (startId > gen.end) return;

  wrap.innerHTML = '<div class="loading"><div class="spinner"></div></div>';

  const promises = [];
  for (let id = startId; id <= endId; id++) {
    promises.push(apiFetch(`https://pokeapi.co/api/v2/pokemon/${id}`).catch(() => null));
  }
  const results = await Promise.all(promises);

  for (const p of results) {
    if (!p) continue;
    const types = p.types.map(t => t.type.name);
    const card = document.createElement('div');
    card.className = 'poke-card';
    card.onclick = () => navigate('detail', p.id);
    card.innerHTML = `
      <div class="poke-id">${padId(p.id)}</div>
      <img src="${pokemonSprite(p.id)}" alt="${p.name}" width="80" height="80" loading="lazy">
      <div class="poke-name">${capitalize(p.name)}</div>
      <div class="types">${types.map(t => typeBadge(t)).join('')}</div>
    `;
    grid.appendChild(card);
  }

  pokedexLoaded += (endId - startId + 1);

  if (gen.start + pokedexLoaded <= gen.end) {
    wrap.innerHTML = `<button class="load-more" onclick="loadPokedexBatch()">Load More Pokémon</button>`;
  } else {
    wrap.innerHTML = '';
  }
}

// ═══════════════════════════════════════
// PAGE: DETAIL
// ═══════════════════════════════════════
async function renderDetail(id) {
  currentPokemonId = id;
  const app = document.getElementById('app');
  app.innerHTML = '<div class="loading"><div class="spinner"></div><p style="margin-top:12px">Loading Pokémon data...</p></div>';

  try {
    const [pokemon, species] = await Promise.all([
      apiFetch(`https://pokeapi.co/api/v2/pokemon/${id}`),
      apiFetch(`https://pokeapi.co/api/v2/pokemon-species/${id}`).catch(() => null)
    ]);

    let evolutions = [];
    if (species?.evolution_chain?.url) {
      try {
        const evoData = await apiFetch(species.evolution_chain.url);
        evolutions = parseEvoChain(evoData.chain);
      } catch(e) {}
    }

    const types = pokemon.types.map(t => t.type.name);
    const primaryType = types[0];
    const abilities = pokemon.abilities.map(a => ({
      name: capitalize(a.ability.name),
      hidden: a.is_hidden
    }));
    const heightM = pokemon.height / 10;
    const weightKg = pokemon.weight / 10;

    // Flavor text
    let flavor = '';
    if (species?.flavor_text_entries) {
      const en = species.flavor_text_entries.find(e => e.language.name === 'en');
      if (en) flavor = en.flavor_text.replace(/[\n\f\r]/g, ' ');
    }
    let genus = '';
    if (species?.genera) {
      const en = species.genera.find(g => g.language.name === 'en');
      if (en) genus = en.genus;
    }

    // Stats
    const stats = {};
    let total = 0;
    pokemon.stats.forEach(s => { stats[s.stat.name] = s.base_stat; total += s.base_stat; });

    // Moves by method
    const levelMoves = [], tmMoves = [], eggMoves = [];
    pokemon.moves.forEach(m => {
      const vg = m.version_group_details;
      const latest = vg[vg.length - 1];
      if (!latest) return;
      const entry = { name: capitalize(m.move.name), rawName: m.move.name, level: latest.level_learned_at, method: latest.move_learn_method.name };
      if (entry.method === 'level-up') levelMoves.push(entry);
      else if (entry.method === 'machine') tmMoves.push(entry);
      else if (entry.method === 'egg') eggMoves.push(entry);
    });
    levelMoves.sort((a, b) => a.level - b.level);
    tmMoves.sort((a, b) => a.name.localeCompare(b.name));
    eggMoves.sort((a, b) => a.name.localeCompare(b.name));

    // Type defenses
    const defenses = {};
    TYPES.forEach(at => {
      let mult = 1;
      types.forEach(dt => mult *= EFF[at][dt]);
      defenses[at] = mult;
    });
    const weak = Object.entries(defenses).filter(([,v]) => v > 1).sort((a,b) => b[1]-a[1]);
    const resist = Object.entries(defenses).filter(([,v]) => v > 0 && v < 1).sort((a,b) => a[1]-b[1]);
    const immune = Object.entries(defenses).filter(([,v]) => v === 0);

    function multLabel(v) {
      if (v === 0) return '0×';
      if (v === 0.25) return '¼×';
      if (v === 0.5) return '½×';
      if (v === 2) return '2×';
      if (v === 4) return '4×';
      return v + '×';
    }

    function defBadges(entries, cls) {
      return entries.map(([t, v]) => `
        <div class="defense-badge">
          <span class="db-type" style="background:${TYPE_COLORS[t]};color:${TYPE_TEXT_COLORS[t]}">${capitalize(t)}</span>
          <span class="db-mult ${cls}">${multLabel(v)}</span>
        </div>
      `).join('');
    }

    app.innerHTML = `
      <div class="detail-nav">
        ${id > 1 ? `<a href="#" onclick="event.preventDefault();navigate('detail',${id-1})">← ${padId(id-1)}</a>` : '<span></span>'}
        <a href="#" onclick="event.preventDefault();navigate('detail',${id+1})">${padId(id+1)} →</a>
      </div>
      <div class="detail-header">
        <h1>${capitalize(pokemon.name)}</h1>
        <div class="did">${padId(id)}</div>
      </div>
      <div class="detail-layout">
        <div class="detail-img" style="background:${TYPE_COLORS[primaryType]}22">
          <img src="${pokemonArtwork(id)}" alt="${pokemon.name}" onerror="this.src='${pokemonSprite(id)}'">
        </div>
        <div class="detail-info">
          ${flavor ? `<div class="flavor">${flavor}</div>` : ''}
          <table class="info-table">
            ${genus ? `<tr><th>Species</th><td>${genus}</td></tr>` : ''}
            <tr><th>Height</th><td>${heightM} m (${(heightM*3.281).toFixed(1)} ft)</td></tr>
            <tr><th>Weight</th><td>${weightKg} kg (${(weightKg*2.205).toFixed(1)} lbs)</td></tr>
            <tr><th>Abilities</th><td>${abilities.map(a => a.name + (a.hidden ? ' <small style="color:#999">(hidden)</small>' : '')).join(', ')}</td></tr>
          </table>
          <div style="margin-top:12px">
            <strong style="font-size:14px;color:#555">Type</strong><br>
            <div style="margin-top:6px">${types.map(t => typeBadge(t, true)).join(' ')}</div>
          </div>
        </div>
      </div>

      <div class="section-card">
        <h2>Base Stats</h2>
        ${['hp','attack','defense','special-attack','special-defense','speed'].map(s => `
          <div class="stat-row">
            <div class="stat-abbr">${STAT_ABBR[s]}</div>
            <div class="stat-val">${stats[s]}</div>
            <div class="stat-bar-bg"><div class="stat-bar-fill" style="width:${(stats[s]/255*100).toFixed(1)}%;background:${statColor(stats[s])}"></div></div>
          </div>
        `).join('')}
        <div class="stat-row" style="margin-top:8px;border-top:1px solid #eee;padding-top:8px">
          <div class="stat-abbr" style="font-weight:700">Total</div>
          <div class="stat-val" style="font-weight:700">${total}</div>
        </div>
      </div>

      ${evolutions.length > 1 ? `
        <div class="section-card">
          <h2>Evolution Chain</h2>
          <div class="evo-chain">
            ${evolutions.map((evo, i) => `
              ${i > 0 ? `<div class="evo-arrow">→${evo.minLevel ? `<small>Lv.${evo.minLevel}</small>` : ''}</div>` : ''}
              <div class="evo-pokemon${evo.id === id ? ' current' : ''}" onclick="navigate('detail',${evo.id})">
                <img src="${pokemonSprite(evo.id)}" alt="${evo.name}">
                <div class="evo-name">${capitalize(evo.name)}</div>
              </div>
            `).join('')}
          </div>
        </div>
      ` : ''}

      <div class="section-card">
        <h2>Type Defenses</h2>
        <p style="color:#666;font-size:13px;margin-bottom:12px">The effectiveness of each type on ${capitalize(pokemon.name)}.</p>
        ${weak.length ? `<div class="defense-group"><h4>Weak to:</h4><div class="defense-badges">${defBadges(weak,'weak')}</div></div>` : ''}
        ${resist.length ? `<div class="defense-group"><h4>Resistant to:</h4><div class="defense-badges">${defBadges(resist,'resist')}</div></div>` : ''}
        ${immune.length ? `<div class="defense-group"><h4>Immune to:</h4><div class="defense-badges">${defBadges(immune,'immune')}</div></div>` : ''}
      </div>

      <div class="section-card">
        <h2>Moves</h2>
        <div class="moves-tabs">
          <div class="moves-tab active" onclick="switchMoveTab(this,'level')">Level Up (${levelMoves.length})</div>
          <div class="moves-tab" onclick="switchMoveTab(this,'tm')">TM/HM (${tmMoves.length})</div>
          <div class="moves-tab" onclick="switchMoveTab(this,'egg')">Egg (${eggMoves.length})</div>
        </div>
        <div id="move-tab-level">
          ${moveTable(levelMoves, true)}
        </div>
        <div id="move-tab-tm" style="display:none">
          ${moveTable(tmMoves, false)}
        </div>
        <div id="move-tab-egg" style="display:none">
          ${moveTable(eggMoves, false)}
        </div>
      </div>
    `;
  } catch(e) {
    app.innerHTML = `<div class="error-msg">Failed to load Pokémon #${id}. ${e.message}</div>`;
  }
}

function switchMoveTab(el, tab) {
  el.parentElement.querySelectorAll('.moves-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  ['level','tm','egg'].forEach(t => {
    const d = document.getElementById('move-tab-' + t);
    if (d) d.style.display = t === tab ? '' : 'none';
  });
}

function moveTable(moves, showLevel) {
  if (!moves.length) return '<p style="color:#999;padding:12px">No moves.</p>';
  return `<table class="moves-table">
    <thead><tr>${showLevel ? '<th>Lv.</th>' : ''}<th>Move</th></tr></thead>
    <tbody>${moves.map(m => `
      <tr>${showLevel ? `<td>${m.level || '—'}</td>` : ''}<td class="move-name">${m.name}</td></tr>
    `).join('')}</tbody>
  </table>`;
}

function parseEvoChain(chain) {
  const evos = [];
  function walk(node) {
    const url = node.species.url;
    const id = parseInt(url.split('/').filter(Boolean).pop());
    const details = node.evolution_details;
    let minLevel = null;
    if (details.length) minLevel = details[0].min_level;
    evos.push({ name: node.species.name, id, minLevel });
    (node.evolves_to || []).forEach(walk);
  }
  walk(chain);
  return evos;
}

// ═══════════════════════════════════════
// PAGE: TYPE CHART
// ═══════════════════════════════════════
function renderTypeChart() {
  const app = document.getElementById('app');
  let html = '<h1 class="page-title">Type Effectiveness Chart</h1>';
  html += '<p class="page-subtitle">How much damage an attacking type deals to a defending type.</p>';
  html += '<div class="type-chart-wrap"><table class="type-chart"><thead><tr><th></th>';
  TYPES.forEach(t => {
    html += `<th><div class="rotate-header" style="color:${TYPE_COLORS[t]}">${capitalize(t)}</div></th>`;
  });
  html += '</tr></thead><tbody>';
  TYPES.forEach(atk => {
    html += `<tr><th style="background:${TYPE_COLORS[atk]};color:${TYPE_TEXT_COLORS[atk]};white-space:nowrap;padding:2px 6px;font-size:11px">${capitalize(atk)}</th>`;
    TYPES.forEach(def => {
      const e = EFF[atk][def];
      let cls = 'tc-1', txt = '';
      if (e === 2) { cls = 'tc-2'; txt = '2'; }
      else if (e === 0.5) { cls = 'tc-half'; txt = '½'; }
      else if (e === 0) { cls = 'tc-0'; txt = '0'; }
      html += `<td class="${cls}">${txt}</td>`;
    });
    html += '</tr>';
  });
  html += '</tbody></table></div>';
  html += `<div class="chart-legend">
    <span><span class="legend-box" style="background:#5fbd58"></span> Super effective (2×)</span>
    <span><span class="legend-box" style="background:#e74c3c"></span> Not very effective (½×)</span>
    <span><span class="legend-box" style="background:#2c2c2c"></span> No effect (0×)</span>
  </div>`;
  app.innerHTML = html;
}

// ═══════════════════════════════════════
// PAGE: MOVES
// ═══════════════════════════════════════
let allMovesData = null;
let movesTypeFilter = '';
let movesCatFilter = '';
let movesSearch = '';
let movesSortCol = 'id';
let movesSortDir = 1;

async function renderMovesPage() {
  const app = document.getElementById('app');
  app.innerHTML = '<h1 class="page-title">Moves</h1><p class="page-subtitle">Complete list of Pokémon moves.</p><div class="loading"><div class="spinner"></div></div>';

  if (!allMovesData) {
    const data = await apiFetch('https://pokeapi.co/api/v2/move?limit=1000');
    // Load details in batches
    const moves = [];
    const batchSize = 50;
    for (let i = 0; i < Math.min(data.results.length, 500); i += batchSize) {
      const batch = data.results.slice(i, i + batchSize);
      const details = await Promise.all(batch.map(m => apiFetch(m.url).catch(() => null)));
      details.forEach(d => {
        if (!d) return;
        moves.push({
          id: d.id,
          name: capitalize(d.name),
          type: d.type?.name || '',
          category: d.damage_class?.name || '',
          power: d.power,
          accuracy: d.accuracy,
          pp: d.pp
        });
      });
      // Update progress
      app.querySelector('.loading').innerHTML = `<div class="spinner"></div><p style="margin-top:12px">Loading moves... ${moves.length}/${Math.min(data.results.length, 500)}</p>`;
    }
    allMovesData = moves;
  }

  renderMovesTable();
}

function renderMovesTable() {
  const app = document.getElementById('app');
  let filtered = allMovesData.filter(m => {
    if (movesTypeFilter && m.type !== movesTypeFilter) return false;
    if (movesCatFilter && m.category !== movesCatFilter) return false;
    if (movesSearch && !m.name.toLowerCase().includes(movesSearch.toLowerCase())) return false;
    return true;
  });

  filtered.sort((a, b) => {
    let va = a[movesSortCol], vb = b[movesSortCol];
    if (va == null) va = -1;
    if (vb == null) vb = -1;
    if (typeof va === 'string') return va.localeCompare(vb) * movesSortDir;
    return (va - vb) * movesSortDir;
  });

  const typeOptions = TYPES.map(t => `<option value="${t}"${movesTypeFilter===t?' selected':''}>${capitalize(t)}</option>`).join('');
  const arrow = movesSortDir === 1 ? ' ↑' : ' ↓';

  app.innerHTML = `
    <h1 class="page-title">Moves</h1>
    <p class="page-subtitle">Complete list of Pokémon moves.</p>
    <div class="moves-filter">
      <input type="text" placeholder="Search moves..." value="${movesSearch}" oninput="movesSearch=this.value;renderMovesTable()">
      <select onchange="movesTypeFilter=this.value;renderMovesTable()">
        <option value="">All Types</option>${typeOptions}
      </select>
      <select onchange="movesCatFilter=this.value;renderMovesTable()">
        <option value=""${!movesCatFilter?' selected':''}>All Categories</option>
        <option value="physical"${movesCatFilter==='physical'?' selected':''}>Physical</option>
        <option value="special"${movesCatFilter==='special'?' selected':''}>Special</option>
        <option value="status"${movesCatFilter==='status'?' selected':''}>Status</option>
      </select>
      <span style="color:#999;font-size:13px">${filtered.length} moves</span>
    </div>
    <div class="section-card" style="padding:0;overflow:hidden">
      <table class="moves-table">
        <thead><tr>
          <th onclick="sortMovesBy('name')">Name${movesSortCol==='name'?arrow:''}</th>
          <th onclick="sortMovesBy('type')">Type${movesSortCol==='type'?arrow:''}</th>
          <th onclick="sortMovesBy('category')">Cat.${movesSortCol==='category'?arrow:''}</th>
          <th onclick="sortMovesBy('power')">Power${movesSortCol==='power'?arrow:''}</th>
          <th onclick="sortMovesBy('accuracy')">Acc.${movesSortCol==='accuracy'?arrow:''}</th>
          <th onclick="sortMovesBy('pp')">PP${movesSortCol==='pp'?arrow:''}</th>
        </tr></thead>
        <tbody>
          ${filtered.slice(0, 200).map(m => `
            <tr>
              <td class="move-name">${m.name}</td>
              <td>${m.type ? typeBadge(m.type) : '—'}</td>
              <td style="text-transform:capitalize">${m.category || '—'}</td>
              <td>${m.power ?? '—'}</td>
              <td>${m.accuracy ? m.accuracy + '%' : '—'}</td>
              <td>${m.pp ?? '—'}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
      ${filtered.length > 200 ? '<div style="padding:12px;text-align:center;color:#999;font-size:13px">Showing first 200 of ' + filtered.length + ' moves</div>' : ''}
    </div>
  `;
}

function sortMovesBy(col) {
  if (movesSortCol === col) movesSortDir *= -1;
  else { movesSortCol = col; movesSortDir = 1; }
  renderMovesTable();
}

// ═══════════════════════════════════════
// INIT
// ═══════════════════════════════════════
navigate('pokedex');
</script>
</body>
</html>
